# Tasks: Markdown 转换系统实现

## 1. 环境准备
- [x] 1.1 安装 Markdown 解析库依赖（`remark`、`remark-react`、`remark-html`、`remark-frontmatter` 等）
- [x] 1.2 安装 YAML 解析库（`js-yaml` 或 `gray-matter`）用于解析 Front Matter
- [x] 1.3 创建 `scripts/` 目录用于存放转换脚本
- [x] 1.4 创建 `content/` 目录用于存放 Markdown 源文件
- [x] 1.5 创建 `content/chapters/` 子目录

## 2. 转换脚本开发
- [x] 2.1 创建基础的 Markdown 转换脚本框架
- [x] 2.2 实现 Markdown → JSX 的基础转换（标题、段落、列表、强调等）
- [x] 2.3 **实现文件元数据提取**：
  - [x] 2.3.1 使用 `fs.statSync()` 获取文件系统元数据（创建时间、修改时间、文件大小）
  - [x] 2.3.2 安装并配置 `remark-frontmatter` 插件解析 YAML Front Matter（使用 gray-matter）
  - [x] 2.3.3 合并 Front Matter 和文件系统元数据（Front Matter 优先）
  - [x] 2.3.4 将日期字符串转换为 Date 对象
- [x] 2.4 实现自定义组件语法解析（`<CodeBlock>`, `<FlipCard>`）
- [x] 2.5 实现 React 组件生成（将 HTML + 组件调用转换为 React 组件代码）
- [x] 2.6 处理代码块和语法高亮
- [x] 2.7 **处理 WebGL 示例代码的特殊情况**：
  - [x] 2.7.1 解析 `<FlipCard>` 组件中的 `<onInit>` 子标签
  - [x] 2.7.2 提取 `<onInit>` 标签内的函数代码
  - [x] 2.7.3 将函数代码转换为 TypeScript 箭头函数，添加类型注解 `(gl: WebGL2RenderingContext, canvas: HTMLCanvasElement) => {...}`
  - [x] 2.7.4 解析 `<codeBlock>` 子标签，转换为 `codeBlocks` 数组
  - [ ] 2.7.5 验证函数代码的语法正确性（可选，运行时验证）
  - [x] 2.7.6 确保生成的组件能够正确渲染 WebGL 内容（构建测试通过）
- [ ] 2.8 **在生成的组件中包含元数据**：
  - [ ] 2.8.1 生成 `metadata` 常量导出
  - [ ] 2.8.2 在组件中添加元数据显示（如"最后更新日期"）
  - [ ] 2.8.3 确保日期格式化为中文格式
- [ ] 2.9 添加错误处理和日志输出
- [ ] 2.10 实现文件监听模式（watch mode）用于开发

## 3. 网站配置和首页内容
- [ ] 3.1 创建 `content/config.yaml`，提取网站配置（标题、描述等）
- [ ] 3.2 创建 `content/home.md`，提取首页内容
- [ ] 3.3 实现配置文件和首页内容的解析
- [ ] 3.4 更新 Home.tsx，改为动态导入章节列表和配置

## 4. 章节列表和索引生成
- [ ] 4.1 实现章节元数据提取功能（从 Front Matter）
- [ ] 4.2 实现章节列表生成（`src/utils/chaptersMetadata.ts`）
- [ ] 4.3 实现搜索索引生成（`src/utils/searchIndex.ts`）
- [ ] 4.4 更新 Home.tsx，使用动态生成的章节列表
- [ ] 4.5 验证章节列表和搜索功能正常工作

## 5. 内容迁移
- [ ] 5.1 分析现有 Chapter0.tsx 的结构，提取内容
- [ ] 5.2 创建 `content/chapters/chapter-0.md`，迁移 Chapter0 的内容（包含 Front Matter）
- [ ] 5.3 测试转换脚本，验证生成的组件是否正确
- [ ] 5.4 逐个迁移其他章节（Chapter1-Chapter10），确保每个都有完整的 Front Matter
- [ ] 5.5 验证所有章节的转换结果
- [ ] 5.6 验证章节列表自动更新

## 6. 构建流程集成
- [ ] 4.1 创建 `pnpm dev:convert` 命令，支持 watch 模式
- [ ] 4.2 更新 `pnpm build` 脚本，在构建前自动运行转换
- [ ] 4.3 创建 Vite 插件（可选），在开发时自动转换
- [ ] 4.4 更新 `.gitignore`，忽略生成的组件文件（如果选择不提交）

## 7. 组件适配
- [ ] 5.1 确保 CodeBlock 组件可以在 Markdown 中正确使用
- [ ] 5.2 确保 FlipCard 组件可以在 Markdown 中正确使用（包括 onInit 函数）
- [ ] 5.3 确保 WebGLCanvas 组件可以在 Markdown 中正确使用
- [ ] 5.4 确保 ChapterNavigation 组件正常工作
- [ ] 5.5 测试所有交互式功能是否正常

## 8. 路由和导航
- [ ] 6.1 验证路由配置是否需要调整
- [ ] 6.2 确保章节导航（ChapterNavigation）正常工作
- [ ] 6.3 确保首页的章节列表正常工作

## 9. 文档和清理
- [ ] 7.1 编写 Markdown 语法文档，说明如何使用自定义组件
- [ ] 7.2 更新 README.md，说明新的内容管理方式
- [ ] 7.3 备份旧的章节组件文件（移动到 `src/pages/chapters/backup/`）
- [ ] 7.4 清理不再需要的代码和文件
- [ ] 7.5 验证部署流程是否正常

## 10. 内容一致性验证
- [ ] 10.1 **创建内容对比工具**：
  - [ ] 10.1.1 实现原始组件和生成组件的结构对比
  - [ ] 10.1.2 实现文本内容对比（逐字符比较）
  - [ ] 10.1.3 实现 CSS 类名对比
  - [ ] 10.1.4 实现组件属性对比
- [ ] 10.2 **逐个章节验证**：
  - [ ] 10.2.1 对比 Chapter0 原始组件和生成组件的渲染结果
  - [ ] 10.2.2 验证所有文本内容完全一致
  - [ ] 10.2.3 验证所有代码块内容完全一致
  - [ ] 10.2.4 验证所有组件属性完全一致
  - [ ] 10.2.5 逐个验证其他章节（Chapter1-Chapter10）
- [ ] 10.3 **功能一致性验证**：
  - [ ] 10.3.1 测试 CodeBlock 复制功能是否一致
  - [ ] 10.3.2 测试 FlipCard 翻转功能是否一致
  - [ ] 10.3.3 测试 WebGL 渲染是否一致（截图对比或渲染结果对比）
  - [ ] 10.3.4 测试 ChapterNavigation 导航是否一致
- [ ] 10.4 **视觉一致性验证**：
  - [ ] 10.4.1 对比页面布局（使用截图或 DOM 结构对比）
  - [ ] 10.4.2 验证所有 CSS 类名是否一致
  - [ ] 10.4.3 验证响应式布局是否一致
  - [ ] 10.4.4 验证主题切换效果是否一致

## 11. 测试和验证
- [ ] 11.1 测试所有章节页面是否正常显示
- [ ] 11.2 测试所有交互式组件是否正常工作
- [ ] 11.3 测试代码块复制功能
- [ ] 11.4 测试 WebGL 示例是否正常运行
- [ ] 11.5 测试响应式布局
- [ ] 11.6 测试主题切换功能
- [ ] 11.7 验证构建产物是否正确
- [ ] 11.8 验证开发时的热更新是否正常
- [ ] 11.9 **回归测试**：
  - [ ] 11.9.1 确保所有原有功能仍然正常工作
  - [ ] 11.9.2 确保没有引入新的 bug
  - [ ] 11.9.3 确保性能没有明显下降

